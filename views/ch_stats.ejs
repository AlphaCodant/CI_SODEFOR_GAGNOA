<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <link href="libs/bootstrap-5.1.3-dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="libs/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script>
    <script src="libs/jquery.js"></script>
    <script src="libs/v6.13.0-dist/ol.js"></script>
    <link rel="stylesheet" href="libs/v6.13.0-dist/ol.css">
    <script src="libs/ol-layerswitcher-master/dist/ol-layerswitcher.js"></script>
    <link rel="stylesheet" href="libs/ol-layerswitcher-master/dist/ol-layerswitcher.css" />
    <script src="libs/ol-geocoder/ol-geocoder.js"></script>
    <link rel="stylesheet" href="libs/ol-geocoder/ol-geocoder.css" />
    <script src="libs/ol-popup/ol-popup.js"></script>
    <link rel="stylesheet" href="libs/ol-popup/ol-popup.css" />
    <link rel="stylesheet" href="libs/jquery-ui-1.12.1/jquery-ui.css">
    <script src="libs/jquery-ui-1.12.1/external/jquery/jquery.js"></script>
    <script src="libs/jquery-ui-1.12.1/jquery-ui.js"></script>
    <link href="css/tailStyle.css" rel="stylesheet" />
    <link href="css/style_perso.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    
    
</head>
<body style="background-color: black;">
    <nav class="fixed top-0 z-50 w-full bg-green-100/0  shadow-zinc-600 text-black">
        <div class="px-3 py-3 lg:px-5 lg:pl-3">
            <div class="flex items-center justify-between">
            <div class="flex items-center justify-start rtl:justify-end">
                <button data-drawer-target="logo-sidebar" data-drawer-toggle="logo-sidebar" aria-controls="logo-sidebar" type="button" class="inline-flex items-center p-2 text-sm text-gray-500 rounded-lg sm:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600">
                    <span class="sr-only"></span>
                    <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path clip-rule="evenodd" fill-rule="evenodd" d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z"></path>
                    </svg>
                </button>
                <a href="#" class="flex ms-2 md:me-24">
                <img src="img/logo2.jpg" class="h-8 me-3" alt="Logo Sodefor" />
                <span class="self-center text-xl font-semibold sm:text-2xl whitespace-nowrap text-black">C.G GAGNOA</span>
                </a>
            </div>
            
        </div>
        </nav>
    <aside id="logo-sidebar" class="fixed top-0 left-0 z-40 w-1/6 h-screen pt-20 transition-transform -translate-x-full  bg-white border-b  shadow-zinc-600 sm:translate-x-0" aria-label="Sidebar">
        <div class="h-full px-3 pb-4 overflow-y-auto  bg-white border-b  shadow-zinc-600">
            <ul class="space-y-2 font-medium">
                <li>
                    <span class="flex items-center py-3 px-1 dark:text-black  border-y border-gray-300 group">
                      <svg class="w-5 h-5 text-purple-500 transition duration-75  group-hover:text-purple-600 " aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 21">
                        <path d="M16.975 11H10V4.025a1 1 0 0 0-1.066-.998 8.5 8.5 0 1 0 9.039 9.039.999.999 0 0 0-1-1.066h.002Z"/>
                        <path d="M12.5 0c-.157 0-.311.01-.565.027A1 1 0 0 0 11 1.02V10h8.975a1 1 0 0 0 1-.935c.013-.188.028-.374.028-.565A8.51 8.51 0 0 0 12.5 0Z"/>
                    </svg>
                    <span class="ms-3">Statistiques</span>
                </span>
                </li>         
            </ul>
            
        </div>
        </aside>
    <script src="js/particules.js"></script>
    <div id="myChart" style="background-color: black;position:absolute;left :16.66%;height:52%;border-radius:2%;width:35%;margin : 1%;border-width: 5px;border-color: white;">        
    </div>
    <div id="myChart3" style="background-color: black;position:absolute;left :16.66%;height:40%;border-radius:2%;width:40%; top:55%; margin : 1%;border-width: 5px;border-color: white;">
    </div>
    <div id="myChart5" style="border-radius: 2%;position:absolute;width:26%;height:52%; left :53%;background: black;margin : 1%;border-width: 5px;border-color: rgb(205, 201, 201);">       
    </div>
    <div style="border-radius: 2%;position:absolute;width:18%;height:48%; left :80%;background: rgb(205, 201, 201);margin : 1%;border-width: 5px;border-color: rgb(205, 201, 201);">
        <div id="stats_stats" class="mt-16" style="background-color: rgb(205, 201, 201); display:inline-block; width: 100%; height: 80%;  padding : 4%; margin:1%;">
            <div style="height: 7%;margin-top: 5%;">
                <div style="align-items: center;text-align: center;">
                    <h2 style="font-weight: bold;color: rgb(0, 0, 0);">Superficie totale</h2>
                </div>
            </div>
            <div style="background-color: #075a2e;border-width: 1px; border-color: black; border-radius: 10%; height: 14%;margin-top: 1%;">
                <div style="align-items: center;text-align: center;">
                    <h1 id ="sup_totale" style="font-weight: bold;font-size: 30px;color:white">Superficie totale</h1>
                </div>
            </div>
            <div style="height: 7%;margin-top: 5%;">
                <div style="align-items: center;text-align: center;margin-top: 1%;">
                    <h2 style="font-weight: bold;color: rgb(0, 0, 0);">Nombre de parcelles</h2>
                </div>
            </div>
            <div style="background-color: #7d0928;border-width: 1px; border-color: black;border-radius: 10%;height: 14%;margin-top: 1%;">
                <div style="align-items: center;text-align: center;">
                    <h1 id ="nb_parcelles" style="font-weight: bold;font-size: 20px;color:white">nb</h1>
                </div>
            </div>
            <div style="height: 7%;margin-top: 5%;">
                <div style="align-items: center;text-align: center;margin-top: 1%;">
                    <h2 style="font-weight: bold;color: rgb(0, 0, 0);">Superficie min</h2>
                </div>
            </div>
            <div style="background-color: #07075a;border-width: 1px; border-color: black;border-radius: 10%;height: 14%;margin-top: 1%;">
                <div style="align-items: center;text-align: center;">
                    <h1 id ="sup_min" style="font-weight: bold;font-size: 20px;color:white">Superficie minimale</h1>
                </div>
            </div>
            <div style="height: 7%;margin-top: 5%;">
                <div style="align-items: center;text-align: center;margin-top: 1%;">
                    <h2 style="font-weight: bold;color: rgb(0, 0, 0);">Superficie max</h2>
                </div>
            </div>
            <div style="background-color: #535006;border-width: 1px; border-color: black;border-radius: 10%; height: 14%;margin-top: 1%;">
                <div style="align-items: center;text-align: center;">
                    <h1 id ="sup_max" style="font-weight: bold;font-size: 20px;color:white">Superficie maximale</h1>
                </div>
            </div>
          </div>        
    </div>
    <div style="border-radius: 2%; background-color:rgb(0, 0, 0);width:40%;height:40%; position:absolute; top:55%;left :58%;margin : 1%;border-width: 5px;border-color: white;">
        <!--<div id="myChart5" style="left:0%;top:0%; position:absolute; width:50%;height:100%;background: black;"></div>-->
        <div id="myChart2" style="left:0%;top:0%; position:absolute; width:100%;height:100%;background: black;"></div>
    </div>
    <script>
        $(document).ready(()=>{
            var donnees_stats = [];
            $.ajax({
                url:'/elements/elem',
                success: (data)=>{
                    //donnees_stats.push(data.features.properties);
                    console.log(data);
                    let sup = 0;
                    let superf = 0;
                    let data_operateur = [];
                    let sup_operateur =[];   
                    let data_essence = [];
                    let sup_essence =[];           
                    for(let i=0;i<data.features.length;i++){
                        sup+=data.features[i].properties['superficie'];
                        superf = data.features[i].properties['superficie']
                        donnees_stats.push(superf)
                        
                        if (data.features[i].properties['partenaire'] in data_operateur){
                                    console.log("ok");
                            }
                            else{
                                data_operateur.push(data.features[i].properties['partenaire']);
                            }

                        if (data.features[i].properties['essence'] in data_essence){
                                console.log("ok");
                        }
                        else{
                            data_essence.push(data.features[i].properties['essence']);
                        }
                        
                    }
                    

                    console.log(data_operateur);
                    document.getElementById("sup_totale").innerHTML=(Math.round(sup * 100)/100).toFixed(2)+ ' ha';
                   //document.getElementById("sup_moyenne").innerHTML=(Math.round(sup/data.features.length * 100)/100).toFixed(2)+ ' ha';
                    document.getElementById("sup_min").innerHTML=(Math.round(Math.min(...donnees_stats) * 100)/100).toFixed(2)+ ' ha';       
                    document.getElementById("sup_max").innerHTML=(Math.round((Math.max(...donnees_stats)) * 100)/100).toFixed(2)+ ' ha';  
                    console.log(donnees_stats.sort())  
                    function uniqueFilter(value, index, self) {
                        return self.indexOf(value) === index;
                    }         
                    
                    let operateur = data_operateur.filter(uniqueFilter);
                    console.log(operateur); 
                    let essence = data_essence.filter(uniqueFilter);
                    console.log(essence); 
                    let donnees_zik = [];
                    //donnees_zik_pyr = [];
                    let donnee_duo_op_sup = [];
                    for(let j=0;j<operateur.length;j++){
                        let sup_op =0;
                        for(let k=0;k<data.features.length;k++){
                            if(data.features[k].properties['partenaire'] == operateur[j]){
                                sup_op+=data.features[k].properties['superficie'];
                            }
                        
                        }
                        var zik = {y:`${Math.round((sup_op*100/sup)*100)/100}`,legendText:`${operateur[j]} ${Math.round((sup_op*100/sup)*100)/100}%`,indexLabel:operateur[j]};
                        //var zik2 = {y:`${Math.round((sup_op*100/sup)*100)/100}`,legendText:`${operateur[j]} ${Math.round((sup_op*100/sup)*100)/100}%`,label:operateur[j]}
                        donnees_zik.push(zik);
                        //donnees_zik_pyr.push(zik2);
                        sup_operateur.push(sup_op);
                        donnee_duo_op_sup.push({y:Math.round((sup_operateur[j]*100/sup)*100)/100,label:operateur[j]});
                        
                    }
                    donnee_duo_op_sup.sort((a, b) => a.y - b.y);
                    
                    for(let j=0;j<essence.length;j++){
                        let sup_es =0;
                        for(let k=0;k<data.features.length;k++){
                            if(data.features[k].properties['essence'] == essence[j]){
                                sup_es+=data.features[k].properties['superficie'];
                            }
                        
                        }
                        sup_essence.push(sup_es);
                        
                    }
                    //Donnees graphique des operateurs en fonction des superficies ==> graph1
                    var donnees_graph1=[];
                    for (let k=0;k<operateur.length;k++){
                        var dict ={y:Math.round(sup_operateur[k]*100)/100,label:operateur[k]};
                        donnees_graph1.push(dict);
                    }
                    //Donnees graphique des essences en fonction des superficies ==> graph1
                    var donnees_graph2=[];
                    var donnees_graph3= [];
                    for (let l=0;l<essence.length;l++){
                        var dict2 ={y:Math.round((sup_essence[l])*100)/100,label:essence[l]};
                        var dict3 ={y:Math.round((sup_essence[l]*100/sup)*100)/100,label:essence[l]};
                        donnees_graph2.push(dict2);
                        donnees_graph3.push(dict3);

                    }

                    /*for (operateurs in operateur){
                        let ul = document.getElementById("nom_operateurs");
                        let li = document.createElement('li');
                        li.appendChild(document.createTextNode(`${operateur[operateurs]} ${(Math.round(sup_operateur[operateurs] * 100)/100).toFixed(2)} ha`));
                        ul.appendChild(li);
                    }*/
                   // document.getElementById("nom_operateurs").innerHTML=operateur[sup_operateur.indexOf(Math.max(...sup_operateur))];
                    //document.getElementById("sup_operateurs").innerHTML=(Math.round(Math.max(...sup_operateur)* 100)/100).toFixed(2)+' ha';
                    //document.getElementById("nb_operateur").innerHTML=(Math.round(operateur.length * 100)/100);
                    document.getElementById("nb_parcelles").innerHTML=(Math.round(data.features.length * 100)/100);

                    console.log(sup_operateur);
                    CanvasJS.addColorSet("blanc", ["#ffffff"])
                    var chart = new CanvasJS.Chart("myChart3",
                    {
                        zoomEnabled: true,
                        panEnabled: true,
                        backgroundColor:"white",
                        //width:600,
                        heigth:200,
                        //colorSet:"blanc",
                        creditText:"",
                        theme:"light1",
                        title:{
                            text: "Superficie par operateur"
                        },
                        
                        data: [
                            {
                            //indexLabel: "{y} ha",
                            neckHeight: 0,
                            toolTipContent: "{label} - {y} ha",        
                            type:"column",
                            dataPoints: donnees_graph1
                        }
                        ]
                    });

                    chart.render();

                    

                    var chart2 = new CanvasJS.Chart("myChart",
                    {
                        zoomEnabled: true,
                        panEnabled: true,
                        backgroundColor:"white",
                        //width:600,
                        heigth:300,
                        //colorSet:"blanc",
                        creditText:"",
                        theme:"light1",
                        title:{
                            text: "Superficie par essence"
                        },
                        
                        data: [
                            {  
                            //indexLabel: "{y} ha",
                            neckHeight: 0,
                            toolTipContent: "{label} - {y} ha",       
                            type:"column",
                            dataPoints: donnees_graph2
                        }
                        ]
                    });

                    chart2.render();


                    var chart5 = new CanvasJS.Chart("myChart5",
                    {
                         
                        title:{
                            text: "Proportion des essences"
                        },
                        
                        data: [
                            { 
                            indexLabel: "{label}-{y}%",
                            neckHeight: 0,
                            toolTipContent: "{label} - {y}%",      
                            type:"doughnut",
                            dataPoints: donnees_graph3
                        }
                        ]
                    });

                    chart5.render();

                    var chart4 = new CanvasJS.Chart("myChart2",
                    {
                         
                        title:{
                            text: "Proportion des operateurs"
                        },
                        
                        data: [
                            {indexLabel: "{y} %",
                            neckHeight: 0,
                            toolTipContent: "{label} - {y}%",      
                            type:"bar",
                            showInLegend: true,
                            dataPoints: donnee_duo_op_sup
                        }
                        ]
                    });

                    chart4.render();

                }
            })
            
        })
        
        
    </script>
    <script src="https://cdn.canvasjs.com/canvasjs.min.js"> </script>

</body>
</html>
