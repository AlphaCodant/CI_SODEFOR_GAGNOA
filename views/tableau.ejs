<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, shrink-to-fit=no"
		/>
		<title>WebStylePress</title>
    <script src="/libs/jquery.js"></script>
    <link rel="stylesheet" href="/libs/jquery-ui-1.12.1/jquery-ui.css">
    <script src="/libs/jquery-ui-1.12.1/external/jquery/jquery.js"></script>
    <script src="/libs/jquery-ui-1.12.1/jquery-ui.js"></script>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css"/>
		<link rel="stylesheet" href="/css/custom2.css" />
        <link rel="stylesheet" href="/css/style_perso.css" />
      <!-- Charger jsPDF depuis un CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Charger le plugin autoTable depuis un CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.21/jspdf.plugin.autotable.min.js"></script>

	</head>
	<body>
        <div id="loader3" class="loader3">
            <img src="/img/loader.gif" alt="Loading...">
          </div>
    
		<div class="container receipt-wrap" id="receipt-wrap">
			<div class="row justify-content-md-center">
				<div class="receipt-main col-xs-12 col-sm-12 col-md-12">
                    <h5 style="font-size: 15px;"
					>Tableau : Dévis de création de plantation industrielle</h5
					<div>						
                        <table border="1" id="table2" class="table col-xs-12 col-sm-12 col-md-12">
                            <thead>
                                <tr>
                                    <th >Travaux</th>
                                    <th >Unité</th>
                                    <th >Coût activité</th>
                                    <th >Superficie (Ha)</th>
                                    <th >Montant (FCFA)</th>
                                </tr>
                                
                            </thead>
                            <tbody id="table10">

                              <tr id="ligne_table1">
                                <td>Rabattage</td><td>Ha</td><td id="td3">40000</td><td id="td41"></td><td id="td51"></td>
                              </tr>
                              <tr id="ligne_table2">
                                <td>Abattage</td><td>Ha</td><td id="td3">45000</td><td id="td42"></td><td id="td52"></td>
                              </tr>
                              <tr id="ligne_table3">
                                <td>Brûlage</td><td>Ha</td><td id="td3">8000</td><td id="td43"></td><td id="td53"></td>
                              </tr>
                              <tr id="ligne_table4">
                                <td>Piquetage</td><td>Ha</td><td id="td3">10000</td><td id="td44"></td><td id="td54"></td>
                              </tr>
                              <tr id="ligne_table5">
                                <td>Marquage</td><td>Ha</td><td id="td3">10000</td><td id="td45"></td><td id="td55"></td>
                              </tr>
                              <!--<tr id="ligne_table6">
                                <td>Trouaison</td><td>Ha</td><td id="td3"></td><td id="td4"></td><td id="td5"></td><td id="td6"></td>
                              </tr>-->
                              <tr id="ligne_table7">
                                <td>Planting</td><td>Ha</td><td id="td3">20000</td><td id="td46"></td><td id="td56"></td>
                              </tr>
                              <tr id="ligne_table8">
                                <td>Entretien 1</td><td>Ha</td><td id="td3">20000</td><td id="td47"></td><td id="td57"></td>
                              </tr>
                              <!--<tr id="ligne_table9">
                                <td>Entretien 1 interligne</td><td>Ha</td><td id="td3"></td><td id="td4"></td><td id="td5"></td><td id="td6"></td>
                              </tr>
                              <tr id="ligne_table10">
                                <td>Remplacement plants morts</td><td>Ha</td><td id="td3"></td><td id="td4"></td><td id="td5"></td><td id="td6"></td>
                              </tr>
                              <tr id="ligne_table11">
                                <td>Entretien en puits</td><td>Ha</td><td id="td3"></td><td id="td4"></td><td id="td5"></td><td id="td6"></td>
                              </tr>-->
                              <tr id="ligne_table12">
                                <td>Entretien 2</td><td>Ha</td><td id="td3">25000</td><td id="td48"></td><td id="td58"></td>
                              </tr>
                              <!--<tr id="ligne_table13">
                                <td>Entretien 2 interlignes</td><td>Ha</td><td id="td3"></td><td id="td4"></td><td id="td5"></td><td id="td6"></td>
                              </tr>-->
                              <tr id="ligne_total">
                                <td>Total</td><td></td><td id="td3"></td><td id="td49"></td><td id="td59"></td>
                              </tr>
                              <tr id="ligne_table15"></tr>
                              <tr id="ligne_table16"></tr>
                              <tr id="ligne_table17"></tr>
                              <tr id="ligne_table18"></tr>
                              <tr id="ligne_table19"></tr>
                              <tr id="ligne_table20"></tr>
                            </tbody>
                        </table>
					</div>
					<br>
					<div class="row">
						<div class="col-xs-8 col-sm-8 col-md-8 text-left">
							<div class="receipt-right">
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
    <br>
    <button id="generatePdfButton" style="position: absolute; color :white; width:50%;background-color: green; border-width: 0%;left: 25%;">Enrégistrer PDF</button>
    <div id="postData" post="<%= id %>"></div>
    
	</body>
	<script>
        const loader2 = document.getElementById('loader3');
        loader2.style.display = 'inline-block';
        setTimeout(()=>{
            loader2.style.display = 'none';   
        },3000);
        let ids = document.getElementById('postData').getAttribute('post');
        
let donnee_get =[];
let liste_num = [];
let sup = {"Rabatage ":0,"Abatage ":0,"Brûlage ":0,"Piquetage ":0,"Marquage ":0,"Planting ":0,"Entretien 1 ":0,"Entretien 2 ":0}
let mont = {"Rabatage ":0,"Abatage ":0,"Brûlage ":0,"Piquetage ":0,"Marquage ":0,"Planting ":0,"Entretien 1 ":0,"Entretien 2 ":0}
let sup_totale = 0;
let mon_total = 0;
let jsonCugf =[];
$(document).ready(function() {  
    $.ajax({
        url: `/data`,
        dataType: "json",
        success: function(json) {
            jsonCugf.push(json);
            console.log(json[2]);
            

            setTimeout(function (){
            
                
    $(document).ready(()=>{
        $.ajax({
            url :`/json/fichier-${ids}.geojson`,
            success : (data)=>{
                for (let i=0;i<data.features.length;i++){
                    liste_num.push(data.features[i].properties['numero']);
                }
            }
        })
    })
    console.log(liste_num);

    setTimeout(()=>{
        for (let jj=0;jj<liste_num.length;jj++){
        console.log(jj);
        for (let z=0; z<jsonCugf[0].length;z++){
            
      let elements=json[z];
      if (elements['donnees_identification/parcelle']==liste_num[jj]){
        if (typeof(elements['donnees_tableau/sous_traitance/surface1'])!="undefined" && typeof(elements['donnees_tableau/sous_traitance/surface1'])!=""){
            sup[elements['donnees_tableau/travail']] +=parseFloat(elements['donnees_tableau/sous_traitance/surface1']) ;
        }
        if (typeof(elements['donnees_tableau/regie/surface2'])!="undefined" && typeof(elements['donnees_tableau/regie/surface2'])!=""){
            sup[elements['donnees_tableau/travail']] +=parseFloat(elements['donnees_tableau/regie/surface2'] );
        }
        
        console.log(sup);
        //sup_totale +=elements['donnees_tableau/regie/surface2'] ;
        /*
        if (typeof(elements['donnees_tableau/regie/homme_jour/cout1_001'])!="undefined" && typeof(elements['donnees_tableau/regie/homme_jour/cout1_001'])!=""){
            mont[elements['donnees_tableau/travail']] +=parseFloat( elements['donnees_tableau/regie/homme_jour/cout1_001'] );
        }
        if (typeof(elements['donnees_tableau/sous_traitance/cout1'])!="undefined" && typeof(elements['donnees_tableau/sous_traitance/cout1'])!=""){
        mont[elements['donnees_tableau/travail']] +=parseFloat( elements['donnees_tableau/sous_traitance/cout1']) ;
        }*/
       //mon_total+=elements['donnees_tableau/regie/homme_jour/cout1_001'] ;
       //mon_total+=elements['donnees_tableau/sous_traitance/cout1'] ;
    }
    
  }

    }
    console.log(sup);
            let c_g = document.getElementById("td41");
			let for_et = document.getElementById("td51");

            let c_g2 = document.getElementById("td42");
			let for_et2 = document.getElementById("td52");

            let c_g3 = document.getElementById("td43");
			let for_et3 = document.getElementById("td53");

            let c_g4 = document.getElementById("td44");
			let for_et4 = document.getElementById("td54");

            let c_g5 = document.getElementById("td45");
			let for_et5 = document.getElementById("td55");

            let c_g6 = document.getElementById("td46");
			let for_et6 = document.getElementById("td56");

            let c_g7 = document.getElementById("td47");
			let for_et7 = document.getElementById("td57");

            let c_g8 = document.getElementById("td48");
			let for_et8 = document.getElementById("td58");

            let c_g9 = document.getElementById("td49");
			let for_et9 = document.getElementById("td59");

            (Math.round(sup * 100)/100).toFixed(2)

            c_g.innerHTML = (Math.round(sup['Rabatage '] * 100)/100).toFixed(2);
            for_et.innerHTML = (Math.round(40000*sup['Rabatage '] * 100)/100);

            c_g2.innerHTML = (Math.round(sup['Abatage '] * 100)/100).toFixed(2);
            for_et2.innerHTML = (Math.round(45000*sup['Abatage '] * 100)/100);

            c_g3.innerHTML = (Math.round(sup['Brûlage '] * 100)/100).toFixed(2);
            for_et3.innerHTML = (Math.round(8000*sup['Brûlage '] * 100)/100);

            c_g4.innerHTML = (Math.round(sup['Piquetage '] * 100)/100).toFixed(2);
            for_et4.innerHTML = (Math.round(10000*sup['Piquetage '] * 100)/100);

            c_g5.innerHTML = (Math.round(sup['Marquage '] * 100)/100).toFixed(2);
            for_et5.innerHTML = (Math.round(10000*sup['Marquage '] * 100)/100);

            c_g6.innerHTML = (Math.round(sup['Planting '] * 100)/100).toFixed(2);
            for_et6.innerHTML = (Math.round(20000*sup['Planting '] * 100)/100);

            c_g7.innerHTML = (Math.round(sup['Entretien 1 '] * 100)/100).toFixed(2);
            for_et7.innerHTML = (Math.round(20000*sup['Entretien 1 '] * 100)/100);

            c_g8.innerHTML = (Math.round(sup['Entretien 2 '] * 100)/100).toFixed(2);
            for_et8.innerHTML = (Math.round(25000*sup['Entretien 2 '] * 100)/100);

            //c_g9.innerHTML = sup['Entretien 2 ']+sup['Entretien 1 ']+sup['Planting ']+sup['Marquage ']+sup['Piquetage ']+sup['Brûlage ']+sup['Abatage ']+sup['Rabatage '];
            let total = 25000*sup['Entretien 2 ']+20000*sup['Entretien 1 ']+20000*sup['Planting ']+10000*sup['Marquage ']+10000*sup['Piquetage ']+8000*sup['Brûlage ']+45000*sup['Abatage ']+40000*sup['Rabatage '];;
             for_et9.innerHTML = (Math.round(total* 100)/100);
    },1000)
    

    

      
            })

      }
    })
    
    });
    console.log(jsonCugf);
    const { jsPDF } = window.jspdf;
    
    document.getElementById('generatePdfButton').addEventListener('click', function () {
      // Créer une nouvelle instance jsPDF
      

      const doc = new jsPDF('l', 'mm', 'a4');  // Format A4



      // Ajouter un sous-titre ou plus de texte
      doc.setFontSize(12);
      doc.text('Tableau : Dévis de création de plantation industrielle', 15, 15); 

    

      

      // Utiliser autoTable pour ajouter le tableau HTML au PDF
      doc.autoTable({
      html: '#table2', // Récupère le tableau HTML
      startY: 30, // Position verticale de départ du tableau
      theme: 'grid', // Applique le thème 'grid' qui montre les bordures de chaque cellule
      styles: {
        lineWidth: 0.5,   // Définir l'épaisseur de la ligne des bordures
        lineColor: [0, 0, 0], // Couleur des bordures (noir ici)
        fontSize: 12,     // Taille de la police du tableau
        cellPadding: 1,   // Espace interne dans les cellules
      },
      headStyles: {
        fillColor: [255, 255, 255], // Fond bleu pour l'en-tête
        textColor: [0, 0, 0], // Texte blanc dans l'en-tête
        lineWidth: 0.1,  // Epaisseur des bordures des entêtes
        lineColor: [0, 0, 0], // Couleur blanche pour les bordures des entêtes
      },
      bodyStyles: {
        lineWidth: 0.1, 
        textColor: [0, 0, 0],  // Bordures plus fines pour les cellules du corps
        lineColor: [0, 0, 0], // Couleur des bordures des cellules (gris clair)
      },
    });

      // Sauvegarder le PDF généré
      doc.save('devis.pdf');
    });
	</script>
	
</html>
